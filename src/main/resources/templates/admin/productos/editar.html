<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Producto</title>
    <!-- ICONOS BOOTSTRAP -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <!-- CSS de Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- ICONOS FONT AWESOME -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- CSS personalizado -->
    <link rel="stylesheet" th:href="@{/css/shared/sidebar.css}">
</head>

<body>
    <!-- Main content -->
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar area (columna izquierda) -->
            <div th:replace="fragments/sidebar :: sidebar"></div>

            <!-- Content area (columna derecha) -->
            <div class="col-md-9 col-lg-10 py-4 px-5 ms-auto">
                <div class="container mt-4">
                    <div class="row mb-3">
                        <div class="col">
                            <a href="#" th:href="@{/admin/productos/}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left"></i>
                            </a>
                            <h1 class="d-inline-block ms-2">Agregar Producto</h1>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">Editar producto</h5>
                            <p class="text-muted">Introduce los cambios del producto para modificarlo</p>

                            <form th:action="@{/admin/productos/actualizar/{id}(id=${producto.idProducto})}"
                                method="post" th:object="${producto}">
                                <!-- Información básica del producto -->
                                <div class="card mb-4">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Información Básica</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <!-- Nombre del producto -->
                                            <div class="col-md-6">
                                                <label for="nombre" class="form-label">Nombre del Producto*</label>
                                                <input type="text" class="form-control" id="nombre" th:field="*{nombre}"
                                                    required>
                                                <div class="invalid-feedback">
                                                    Por favor ingrese el nombre del producto.
                                                </div>
                                            </div>

                                            <!-- Descripción -->
                                            <div class="col-12">
                                                <label for="descripcion" class="form-label">Descripción*</label>
                                                <textarea class="form-control" id="descripcion"
                                                    th:field="*{descripcion}" rows="4" required></textarea>
                                                <div class="invalid-feedback">
                                                    Por favor ingrese una descripción.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Información de categorización -->
                                <div class="card mb-4">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-tags me-2"></i>Categorización</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <!-- Categoría -->
                                            <div class="col-md-4">
                                                <label for="categoria" class="form-label">Categoría*</label>
                                                <select class="form-select" id="categoria" th:field="*{categoria.id}"
                                                    required>
                                                    <option value="" selected disabled>Seleccione una categoría</option>
                                                    <option th:each="cat : ${categorias}" th:value="${cat.id}"
                                                        th:text="${cat.nombre}"></option>
                                                </select>
                                                <div class="invalid-feedback">
                                                    Por favor seleccione una categoría.
                                                </div>
                                            </div>

                                            <!-- Marca -->
                                            <div class="col-md-4">
                                                <label for="marca" class="form-label">Marca*</label>
                                                <select class="form-select" id="marca" th:field="*{marca.id}" required>
                                                    <option value="" selected disabled>Seleccione una marca</option>
                                                    <option th:each="m : ${marcas}" th:value="${m.id}"
                                                        th:text="${m.nombre}"></option>
                                                </select>
                                                <div class="invalid-feedback">
                                                    Por favor seleccione una marca.
                                                </div>
                                            </div>

                                            <!-- Ubicación -->
                                            <div class="col-md-4">
                                                <label for="ubicacion" class="form-label">Ubicación</label>
                                                <select class="form-select" id="ubicacion"
                                                    th:field="*{ubicacion.idUbicacion}">
                                                    <option value="" selected>Sin ubicación</option>
                                                    <option th:each="ubi : ${ubicacion}" th:value="${ubi.idUbicacion}"
                                                        th:text="${ubi.nombre}"></option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Información de precios y stock -->
                                <div class="card mb-4">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-dollar-sign me-2"></i>Precios y Stock</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <!-- Precio normal -->
                                            <div class="col-md-3">
                                                <label for="precio" class="form-label">Precio normal*</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">S/</span>
                                                    <input type="number" class="form-control" id="precio"
                                                        th:field="*{precio}" step="0.01" min="0" required>
                                                </div>
                                                <div class="invalid-feedback">
                                                    Por favor ingrese un precio válido.
                                                </div>
                                            </div>

                                            <!-- Stock -->
                                            <div class="col-md-3">
                                                <label for="stock" class="form-label">Stock disponible*</label>
                                                <input type="number" class="form-control" id="stock" th:field="*{stock}"
                                                    min="0" required>
                                                <div class="invalid-feedback">
                                                    Por favor ingrese el stock disponible.
                                                </div>
                                            </div>

                                            <!-- Tipo de descuento -->
                                            <div class="col-md-2">
                                                <label for="tipoDescuento" class="form-label">Tipo descuento</label>
                                                <select class="form-select" id="tipoDescuento"
                                                    th:field="*{tipoDescuento}">
                                                    <option value="">Sin descuento</option>
                                                    <option value="porcentaje">Porcentaje (%)</option>
                                                    <option value="monto">Monto fijo (S/)</option>
                                                </select>
                                            </div>

                                            <!-- Valor del descuento -->
                                            <div class="col-md-2">
                                                <label for="descuento" class="form-label">Valor descuento</label>
                                                <input type="number" class="form-control" id="descuento"
                                                    th:field="*{descuento}" step="0.01" min="0">
                                                <small class="form-text text-muted">% o S/ según tipo</small>
                                            </div>

                                            <!-- Precio oferta (calculado) -->
                                            <div class="col-md-2">
                                                <label for="precioOferta" class="form-label">Precio oferta</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">S/</span>
                                                    <input type="number" class="form-control" id="precioOferta"
                                                        th:field="*{precioOferta}" step="0.01" min="0" readonly>
                                                </div>
                                                <small class="form-text text-muted">Se calcula automáticamente</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Proveedor y estado -->
                                <div class="card mb-4">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-truck me-2"></i>Proveedor y Estado</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <!-- Proveedor principal -->
                                            <div class="col-md-6">
                                                <label for="proveedor" class="form-label">Proveedor de este
                                                    producto*</label>
                                                <select class="form-select" id="proveedor" th:field="*{proveedor}"
                                                    required>
                                                    <option value="" selected disabled>Seleccione un proveedor</option>
                                                    <option th:each="proveedor : ${proveedores}"
                                                        th:value="${proveedor.idProveedor}"
                                                        th:text="${proveedor.nombre}">
                                                    </option>
                                                </select>
                                                <div class="invalid-feedback">
                                                    Por favor seleccione un proveedor.
                                                </div>
                                            </div>

                                            <!-- Estado (activo/inactivo) -->
                                            <div class="col-md-6">
                                                <label class="form-label d-block">Estado del producto</label>
                                                <div class="form-check form-check-inline mt-2">
                                                    <input class="form-check-input" type="radio" id="activoSi"
                                                        th:field="*{activo}" th:value="true" checked>
                                                    <label class="form-check-label" for="activoSi">
                                                        <span class="badge bg-success">Activo</span>
                                                    </label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" id="activoNo"
                                                        th:field="*{activo}" th:value="false">
                                                    <label class="form-check-label" for="activoNo">
                                                        <span class="badge bg-danger">Inactivo</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Imágenes -->
                                <div class="mb-3">
                                    <label for="imagenPrincipal" class="form-label">Imagen principal (URL)</label>
                                    <input type="text" class="form-control" th:field="*{imagenURL}"
                                        placeholder="https://ejemplo.com/imagen1.jpg">
                                </div>

                                <!-- Botones de acción -->
                                <div class="d-flex justify-content-between mt-4">
                                    <a th:href="@{/admin/productos/}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-1"></i> Cancelar
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-1"></i> Guardar Cambios
                                    </button>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            // Cálculo automático del precio de oferta
            document.addEventListener('DOMContentLoaded', function () {
                const precioInput = document.getElementById('precio');
                const tipoDescuentoSelect = document.getElementById('tipoDescuento');
                const descuentoInput = document.getElementById('descuento');
                const precioOfertaInput = document.getElementById('precioOferta');

                function calcularPrecioOferta() {
                    const precio = parseFloat(precioInput.value) || 0;
                    const tipoDescuento = tipoDescuentoSelect.value;
                    const descuento = parseFloat(descuentoInput.value) || 0;

                    let precioOferta = precio;

                    if (tipoDescuento === 'porcentaje' && descuento > 0) {
                        precioOferta = precio - (precio * (descuento / 100));
                    } else if (tipoDescuento === 'monto' && descuento > 0) {
                        precioOferta = precio - descuento;
                    }

                    // Asegurar que el precio de oferta no sea negativo
                    precioOferta = Math.max(0, precioOferta);

                    // Redondear a 2 decimales y actualizar el campo
                    precioOfertaInput.value = precioOferta.toFixed(2);
                }

                // Evento para recalcular cuando cambian los valores
                precioInput.addEventListener('input', calcularPrecioOferta);
                tipoDescuentoSelect.addEventListener('change', calcularPrecioOferta);
                descuentoInput.addEventListener('input', calcularPrecioOferta);

                // Calcular al cargar la página
                calcularPrecioOferta();
            });
        </script>
</body>

</html>